---
title: "ggbiplot New Feature Test for Windows, Linux and macOS"
author: "Sampo Suzuki"
date: "2019年3月8日"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)

require(tidyverse)

# ファイル位置に合わせて変更してください
src_file <- "../R/ggbiplot.r"
data_file <- "../data/wine.rda"

source(src_file, encoding = 'UTF-8')
load(data_file)


# OS環境によりフォントを変える
if (Sys.info()[1] == "Windows") {
  windowsFonts(meiryo = windowsFont("Meiryo"),
               ms_pmin = windowsFont("ＭＳ Ｐ明朝"),
               ms_got = windowsFont("ＭＳ ゴシック"))
  base_family = c("ms_pmin")
  family = c("meiryo")
} else if (Sys.info()[1] == "Linux") {
  base_family = c("Noto Serif CJK JP")
  family = c("Noto Mono")
} else {  # macOS
  base_family = c("HiraKakuPro-W3")
  family = c("Osaka")
}
```

本ファイルは`ggbiplot`に日本語フォントを指定できるように改修に対するテスト用のコードを記載してあります。Linux環境では日本語フォントとして`Noto`フォントの利用を前提としていますので、`Noto`フォントがインストールされていない場合には [こちら（ファイルサイズは1.1GB） <i class="fa fa-external-link"></i>](https://www.google.com/get/noto/help/install/){target="_blank" title="Google Note Fonts"} からダウンロードするか、ソースのフォント指定を変更してください。Windows(7 or later)ならびにmacOSではデフォルトでインストールされているフォントを使っています。


# テスト用フォントの設定
```{r}
base_family
family
```


#　動作確認
## フォント未指定の場合
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl))
```

## 両方とも指定した場合
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           base_family = base_family, family = family)
```

## baseのみ指定した場合
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           base_family = base_family)
```

## 変量名のみ指定した場合
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           family = family)
```

# その他オプションとの併用
## 変量名のみ指定し、ラベルを表示する
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           labels = row.names(mtcars), family = family)
```


## 両方指定し、分類円（ellipse）を表示させる
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = TRUE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           labels = row.names(mtcars), 
           base_family = base_family, family = family)
```

## ラベルサイズを変更する
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           labels = row.names(mtcars), labels.size = 3.5,
           family = family)
```

## 変量名サイズを変更する
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           labels = row.names(mtcars), varname.size = 4,
           family = family)
```

## ラベルを非表示にして変量番号（ID）を表示する
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           varname.size = 4, id = TRUE, 
           family = family)
```

# グループ表示をしない
## ラベル表示
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = NULL,
           labels = row.names(mtcars), varname.size = 4,
           family = family)
```

## ID表示
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = NULL,
           varname.size = 4, id = TRUE, 
           family = family)
```

# ggplot2との連携確認

## theme系
```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           labels = row.names(mtcars), varname.size = 4,
           family = family) + 
  ggplot2::theme_classic()
```

```{r}
mtcars %>% 
  dplyr::select(`車重` = wt, `1/4mileタイム` = qsec, `ミッション` = am) %>%
  prcomp(scale. = TRUE) %>%
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = FALSE,
           circle = TRUE, groups = as.factor(mtcars$cyl),
           labels = row.names(mtcars), varname.size = 4,
           family = family) + 
  ggplot2::theme_bw()
```

# 様々なレイヤーを追加
```{r}
wine %>% 
  prcomp(scale. = TRUE) %>% 
  ggbiplot(obs.scale = 1, var.scale = 1, ellipse = TRUE, alpha = 0.5,
           circle = TRUE, groups = wine.class, id = TRUE,
           family = family) +
    ggplot2::theme_light() + 
    ggplot2::xlim(c(-4.5, 4.5)) + ggplot2::ylim(c(-4.5, 4.5)) + 
    ggplot2::coord_equal() + ggplot2::coord_flip() + 
    ggplot2::geom_hline(yintercept = 0, linetype = "dashed") + 
    ggplot2::geom_vline(xintercept = 0, linetype = "dashed") + 
    ggplot2::scale_color_brewer(palette = "Set2")
```
